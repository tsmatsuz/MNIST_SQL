### Set compute context
con <- "Driver=SQL Server;Server={your server address};Database={your database};Uid={db user id};Pwd={db user password}"
sqlCompute <- RxInSqlServer(
  connectionString = con,
  wait = T,
  numTasks = 5,
  consoleOutput = F)
rxSetComputeContext(sqlCompute)
#rxSetComputeContext("local")  # if debugging in local !

### Train
train <- RxSqlServerData(
  connectionString = con,
  databaseName = "testdb",
  sqlQuery = "SELECT TOP 41000 * FROM MnistImgTbl ORDER BY ID ASC",
  rowsPerRead = 10000,
  stringsAsFactors = T)
net <- ("input Data [28, 28];
         hidden H1 [128] rlinear from Data all;
         hidden H2 [64] rlinear from H1 all;
         output Out [10] softmax from H2 all;")
model <- rxNeuralNet(
  Label ~ Pixel1 + Pixel2 + Pixel3 + Pixel4 + Pixel5 + Pixel6 + Pixel7 + Pixel8 + Pixel9 + Pixel10 + Pixel11 + Pixel12 + Pixel13 + Pixel14 + Pixel15 + Pixel16 + Pixel17 + Pixel18 + Pixel19 + Pixel20 + Pixel21 + Pixel22 + Pixel23 + Pixel24 + Pixel25 + Pixel26 + Pixel27 + Pixel28 + Pixel29 + Pixel30 + Pixel31 + Pixel32 + Pixel33 + Pixel34 + Pixel35 + Pixel36 + Pixel37 + Pixel38 + Pixel39 + Pixel40 + Pixel41 + Pixel42 + Pixel43 + Pixel44 + Pixel45 + Pixel46 + Pixel47 + Pixel48 + Pixel49 + Pixel50 + Pixel51 + Pixel52 + Pixel53 + Pixel54 + Pixel55 + Pixel56 + Pixel57 + Pixel58 + Pixel59 + Pixel60 + Pixel61 + Pixel62 + Pixel63 + Pixel64 + Pixel65 + Pixel66 + Pixel67 + Pixel68 + Pixel69 + Pixel70 + Pixel71 + Pixel72 + Pixel73 + Pixel74 + Pixel75 + Pixel76 + Pixel77 + Pixel78 + Pixel79 + Pixel80 + Pixel81 + Pixel82 + Pixel83 + Pixel84 + Pixel85 + Pixel86 + Pixel87 + Pixel88 + Pixel89 + Pixel90 + Pixel91 + Pixel92 + Pixel93 + Pixel94 + Pixel95 + Pixel96 + Pixel97 + Pixel98 + Pixel99 + Pixel100
    + Pixel101 + Pixel102 + Pixel103 + Pixel104 + Pixel105 + Pixel106 + Pixel107 + Pixel108 + Pixel109 + Pixel110 + Pixel111 + Pixel112 + Pixel113 + Pixel114 + Pixel115 + Pixel116 + Pixel117 + Pixel118 + Pixel119 + Pixel120 + Pixel121 + Pixel122 + Pixel123 + Pixel124 + Pixel125 + Pixel126 + Pixel127 + Pixel128 + Pixel129 + Pixel130 + Pixel131 + Pixel132 + Pixel133 + Pixel134 + Pixel135 + Pixel136 + Pixel137 + Pixel138 + Pixel139 + Pixel140 + Pixel141 + Pixel142 + Pixel143 + Pixel144 + Pixel145 + Pixel146 + Pixel147 + Pixel148 + Pixel149 + Pixel150 + Pixel151 + Pixel152 + Pixel153 + Pixel154 + Pixel155 + Pixel156 + Pixel157 + Pixel158 + Pixel159 + Pixel160 + Pixel161 + Pixel162 + Pixel163 + Pixel164 + Pixel165 + Pixel166 + Pixel167 + Pixel168 + Pixel169 + Pixel170 + Pixel171 + Pixel172 + Pixel173 + Pixel174 + Pixel175 + Pixel176 + Pixel177 + Pixel178 + Pixel179 + Pixel180 + Pixel181 + Pixel182 + Pixel183 + Pixel184 + Pixel185 + Pixel186 + Pixel187 + Pixel188 + Pixel189 + Pixel190 + Pixel191 + Pixel192 + Pixel193 + Pixel194 + Pixel195 + Pixel196 + Pixel197 + Pixel198 + Pixel199 + Pixel200
    + Pixel201 + Pixel202 + Pixel203 + Pixel204 + Pixel205 + Pixel206 + Pixel207 + Pixel208 + Pixel209 + Pixel210 + Pixel211 + Pixel212 + Pixel213 + Pixel214 + Pixel215 + Pixel216 + Pixel217 + Pixel218 + Pixel219 + Pixel220 + Pixel221 + Pixel222 + Pixel223 + Pixel224 + Pixel225 + Pixel226 + Pixel227 + Pixel228 + Pixel229 + Pixel230 + Pixel231 + Pixel232 + Pixel233 + Pixel234 + Pixel235 + Pixel236 + Pixel237 + Pixel238 + Pixel239 + Pixel240 + Pixel241 + Pixel242 + Pixel243 + Pixel244 + Pixel245 + Pixel246 + Pixel247 + Pixel248 + Pixel249 + Pixel250 + Pixel251 + Pixel252 + Pixel253 + Pixel254 + Pixel255 + Pixel256 + Pixel257 + Pixel258 + Pixel259 + Pixel260 + Pixel261 + Pixel262 + Pixel263 + Pixel264 + Pixel265 + Pixel266 + Pixel267 + Pixel268 + Pixel269 + Pixel270 + Pixel271 + Pixel272 + Pixel273 + Pixel274 + Pixel275 + Pixel276 + Pixel277 + Pixel278 + Pixel279 + Pixel280 + Pixel281 + Pixel282 + Pixel283 + Pixel284 + Pixel285 + Pixel286 + Pixel287 + Pixel288 + Pixel289 + Pixel290 + Pixel291 + Pixel292 + Pixel293 + Pixel294 + Pixel295 + Pixel296 + Pixel297 + Pixel298 + Pixel299 + Pixel300
    + Pixel301 + Pixel302 + Pixel303 + Pixel304 + Pixel305 + Pixel306 + Pixel307 + Pixel308 + Pixel309 + Pixel310 + Pixel311 + Pixel312 + Pixel313 + Pixel314 + Pixel315 + Pixel316 + Pixel317 + Pixel318 + Pixel319 + Pixel320 + Pixel321 + Pixel322 + Pixel323 + Pixel324 + Pixel325 + Pixel326 + Pixel327 + Pixel328 + Pixel329 + Pixel330 + Pixel331 + Pixel332 + Pixel333 + Pixel334 + Pixel335 + Pixel336 + Pixel337 + Pixel338 + Pixel339 + Pixel340 + Pixel341 + Pixel342 + Pixel343 + Pixel344 + Pixel345 + Pixel346 + Pixel347 + Pixel348 + Pixel349 + Pixel350 + Pixel351 + Pixel352 + Pixel353 + Pixel354 + Pixel355 + Pixel356 + Pixel357 + Pixel358 + Pixel359 + Pixel360 + Pixel361 + Pixel362 + Pixel363 + Pixel364 + Pixel365 + Pixel366 + Pixel367 + Pixel368 + Pixel369 + Pixel370 + Pixel371 + Pixel372 + Pixel373 + Pixel374 + Pixel375 + Pixel376 + Pixel377 + Pixel378 + Pixel379 + Pixel380 + Pixel381 + Pixel382 + Pixel383 + Pixel384 + Pixel385 + Pixel386 + Pixel387 + Pixel388 + Pixel389 + Pixel390 + Pixel391 + Pixel392 + Pixel393 + Pixel394 + Pixel395 + Pixel396 + Pixel397 + Pixel398 + Pixel399 + Pixel400
    + Pixel401 + Pixel402 + Pixel403 + Pixel404 + Pixel405 + Pixel406 + Pixel407 + Pixel408 + Pixel409 + Pixel410 + Pixel411 + Pixel412 + Pixel413 + Pixel414 + Pixel415 + Pixel416 + Pixel417 + Pixel418 + Pixel419 + Pixel420 + Pixel421 + Pixel422 + Pixel423 + Pixel424 + Pixel425 + Pixel426 + Pixel427 + Pixel428 + Pixel429 + Pixel430 + Pixel431 + Pixel432 + Pixel433 + Pixel434 + Pixel435 + Pixel436 + Pixel437 + Pixel438 + Pixel439 + Pixel440 + Pixel441 + Pixel442 + Pixel443 + Pixel444 + Pixel445 + Pixel446 + Pixel447 + Pixel448 + Pixel449 + Pixel450 + Pixel451 + Pixel452 + Pixel453 + Pixel454 + Pixel455 + Pixel456 + Pixel457 + Pixel458 + Pixel459 + Pixel460 + Pixel461 + Pixel462 + Pixel463 + Pixel464 + Pixel465 + Pixel466 + Pixel467 + Pixel468 + Pixel469 + Pixel470 + Pixel471 + Pixel472 + Pixel473 + Pixel474 + Pixel475 + Pixel476 + Pixel477 + Pixel478 + Pixel479 + Pixel480 + Pixel481 + Pixel482 + Pixel483 + Pixel484 + Pixel485 + Pixel486 + Pixel487 + Pixel488 + Pixel489 + Pixel490 + Pixel491 + Pixel492 + Pixel493 + Pixel494 + Pixel495 + Pixel496 + Pixel497 + Pixel498 + Pixel499 + Pixel500
    + Pixel501 + Pixel502 + Pixel503 + Pixel504 + Pixel505 + Pixel506 + Pixel507 + Pixel508 + Pixel509 + Pixel510 + Pixel511 + Pixel512 + Pixel513 + Pixel514 + Pixel515 + Pixel516 + Pixel517 + Pixel518 + Pixel519 + Pixel520 + Pixel521 + Pixel522 + Pixel523 + Pixel524 + Pixel525 + Pixel526 + Pixel527 + Pixel528 + Pixel529 + Pixel530 + Pixel531 + Pixel532 + Pixel533 + Pixel534 + Pixel535 + Pixel536 + Pixel537 + Pixel538 + Pixel539 + Pixel540 + Pixel541 + Pixel542 + Pixel543 + Pixel544 + Pixel545 + Pixel546 + Pixel547 + Pixel548 + Pixel549 + Pixel550 + Pixel551 + Pixel552 + Pixel553 + Pixel554 + Pixel555 + Pixel556 + Pixel557 + Pixel558 + Pixel559 + Pixel560 + Pixel561 + Pixel562 + Pixel563 + Pixel564 + Pixel565 + Pixel566 + Pixel567 + Pixel568 + Pixel569 + Pixel570 + Pixel571 + Pixel572 + Pixel573 + Pixel574 + Pixel575 + Pixel576 + Pixel577 + Pixel578 + Pixel579 + Pixel580 + Pixel581 + Pixel582 + Pixel583 + Pixel584 + Pixel585 + Pixel586 + Pixel587 + Pixel588 + Pixel589 + Pixel590 + Pixel591 + Pixel592 + Pixel593 + Pixel594 + Pixel595 + Pixel596 + Pixel597 + Pixel598 + Pixel599 + Pixel600
    + Pixel601 + Pixel602 + Pixel603 + Pixel604 + Pixel605 + Pixel606 + Pixel607 + Pixel608 + Pixel609 + Pixel610 + Pixel611 + Pixel612 + Pixel613 + Pixel614 + Pixel615 + Pixel616 + Pixel617 + Pixel618 + Pixel619 + Pixel620 + Pixel621 + Pixel622 + Pixel623 + Pixel624 + Pixel625 + Pixel626 + Pixel627 + Pixel628 + Pixel629 + Pixel630 + Pixel631 + Pixel632 + Pixel633 + Pixel634 + Pixel635 + Pixel636 + Pixel637 + Pixel638 + Pixel639 + Pixel640 + Pixel641 + Pixel642 + Pixel643 + Pixel644 + Pixel645 + Pixel646 + Pixel647 + Pixel648 + Pixel649 + Pixel650 + Pixel651 + Pixel652 + Pixel653 + Pixel654 + Pixel655 + Pixel656 + Pixel657 + Pixel658 + Pixel659 + Pixel660 + Pixel661 + Pixel662 + Pixel663 + Pixel664 + Pixel665 + Pixel666 + Pixel667 + Pixel668 + Pixel669 + Pixel670 + Pixel671 + Pixel672 + Pixel673 + Pixel674 + Pixel675 + Pixel676 + Pixel677 + Pixel678 + Pixel679 + Pixel680 + Pixel681 + Pixel682 + Pixel683 + Pixel684 + Pixel685 + Pixel686 + Pixel687 + Pixel688 + Pixel689 + Pixel690 + Pixel691 + Pixel692 + Pixel693 + Pixel694 + Pixel695 + Pixel696 + Pixel697 + Pixel698 + Pixel699 + Pixel700
    + Pixel701 + Pixel702 + Pixel703 + Pixel704 + Pixel705 + Pixel706 + Pixel707 + Pixel708 + Pixel709 + Pixel710 + Pixel711 + Pixel712 + Pixel713 + Pixel714 + Pixel715 + Pixel716 + Pixel717 + Pixel718 + Pixel719 + Pixel720 + Pixel721 + Pixel722 + Pixel723 + Pixel724 + Pixel725 + Pixel726 + Pixel727 + Pixel728 + Pixel729 + Pixel730 + Pixel731 + Pixel732 + Pixel733 + Pixel734 + Pixel735 + Pixel736 + Pixel737 + Pixel738 + Pixel739 + Pixel740 + Pixel741 + Pixel742 + Pixel743 + Pixel744 + Pixel745 + Pixel746 + Pixel747 + Pixel748 + Pixel749 + Pixel750 + Pixel751 + Pixel752 + Pixel753 + Pixel754 + Pixel755 + Pixel756 + Pixel757 + Pixel758 + Pixel759 + Pixel760 + Pixel761 + Pixel762 + Pixel763 + Pixel764 + Pixel765 + Pixel766 + Pixel767 + Pixel768 + Pixel769 + Pixel770 + Pixel771 + Pixel772 + Pixel773 + Pixel774 + Pixel775 + Pixel776 + Pixel777 + Pixel778 + Pixel779 + Pixel780 + Pixel781 + Pixel782 + Pixel783 + Pixel784,
  data = train,
  netDefinition = net,
  type = "multiClass"
)

### Predict
test <- RxSqlServerData(
  connectionString = con,
  databaseName = "testdb",
  sqlQuery = "SELECT TOP 1000 * FROM MnistImgTbl ORDER BY ID DESC",
  rowsPerRead = 10000,
  stringsAsFactors = T)
results <- rxPredict(
  model,
  data = test,
  extraVarsToWrite = c("ID","Label")
)
